import{e as P,u as O,a as k,c as A,l as D,r as j,j as e,B as N,S as a}from"./index-xxW3EWhZ.js";import{C}from"./Container-cHf7Nnv1.js";import{C as i}from"./Card-CM3nr3_2.js";function G(){const c=P(t=>t.userProfile),m=O(t=>t.goals),v=k(t=>t.plans),h=A(t=>t.dailyPages),S=D(t=>t.reviews),[u,g]=j.useState(""),[y,b]=j.useState(!1),n={totalGoals:m.tenYear.length+m.fiveYear.length+m.oneYear.length,totalPlans:v.length,totalDailyPages:Object.keys(h).length,completedDays:Object.values(h).filter(t=>t.status==="completed").length,totalReviews:S.length,storageUsed:w()};function w(){try{let t=0;for(const l in localStorage)localStorage.hasOwnProperty(l)&&(t+=localStorage[l].length+l.length);return Math.round(t/1024)}catch{return 0}}const E=()=>{const t={version:"1.0.0",exportedAt:new Date().toISOString(),data:{profile:localStorage.getItem(a.USER_PROFILE),goals:localStorage.getItem(a.GOALS),plans:localStorage.getItem(a.PLANS_90DAY),dailyPages:localStorage.getItem(a.DAILY_PAGES),weeklyReviews:localStorage.getItem(a.WEEKLY_REVIEWS)}},l=JSON.stringify(t,null,2),o=new Blob([l],{type:"application/json"}),d=URL.createObjectURL(o),r=document.createElement("a");r.href=d,r.download=`ezhednevnik-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(d)},I=t=>{var d;const l=(d=t.target.files)==null?void 0:d[0];if(!l)return;g(""),b(!1);const o=new FileReader;o.onload=r=>{var f;try{const x=(f=r.target)==null?void 0:f.result,p=JSON.parse(x);if(!p.version||!p.data)throw new Error("Неверный формат файла");if(!window.confirm(`Импорт данных заменит все текущие данные. Вы уверены?

Рекомендуется сначала создать резервную копию текущих данных.`)){t.target.value="";return}const{data:s}=p;s.profile&&localStorage.setItem(a.USER_PROFILE,s.profile),s.goals&&localStorage.setItem(a.GOALS,s.goals),s.plans&&localStorage.setItem(a.PLANS_90DAY,s.plans),s.dailyPages&&localStorage.setItem(a.DAILY_PAGES,s.dailyPages),s.weeklyReviews&&localStorage.setItem(a.WEEKLY_REVIEWS,s.weeklyReviews),b(!0),setTimeout(()=>{window.location.reload()},1500)}catch(x){g(x instanceof Error?x.message:"Ошибка при чтении файла. Проверьте формат JSON.")}},o.onerror=()=>{g("Ошибка при чтении файла")},o.readAsText(l)},R=()=>{!window.confirm(`ВНИМАНИЕ!

Это действие удалит ВСЕ данные без возможности восстановления:

• Все цели
• Все планы на 90 дней
• Все ежедневные страницы
• Все еженедельные обзоры
• Настройки профиля

Вы УВЕРЕНЫ?`)||!window.confirm(`Последнее предупреждение!

Все данные будут безвозвратно удалены. Продолжить?`)||(localStorage.clear(),window.location.href="/")};return e.jsx(C,{size:"xl",children:e.jsxs("div",{className:"py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold gradient-text mb-3",children:"Настройки"}),e.jsx("p",{className:"text-lg text-text-secondary",children:"Управление данными, экспорт и импорт"})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[c&&e.jsxs(i,{variant:"gradient",accentColor:"blue",children:[e.jsx("h3",{className:"font-semibold text-text-primary mb-4",children:"Информация о профиле"}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between p-3 bg-glass-light rounded-glass-sm",children:[e.jsx("span",{className:"text-text-secondary",children:"ID профиля:"}),e.jsxs("span",{className:"font-mono text-xs text-text-muted",children:[c.id.slice(0,8),"..."]})]}),e.jsxs("div",{className:"flex justify-between p-3 bg-glass-light rounded-glass-sm",children:[e.jsx("span",{className:"text-text-secondary",children:"Дата создания:"}),e.jsx("span",{className:"text-text-primary",children:new Date(c.createdAt).toLocaleDateString("ru-RU")})]}),e.jsxs("div",{className:"flex justify-between p-3 bg-glass-light rounded-glass-sm",children:[e.jsx("span",{className:"text-text-secondary",children:"Онбординг:"}),e.jsx("span",{className:c.onboardingCompleted?"text-success":"text-warning",children:c.onboardingCompleted?"Пройден":"Не пройден"})]})]})]}),e.jsxs(i,{children:[e.jsx("h3",{className:"font-semibold text-text-primary mb-4",children:"Статистика данных"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-4 bg-accent-blue/10 border border-accent-blue/20 rounded-glass-sm text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-accent-blue",children:n.totalGoals}),e.jsx("div",{className:"text-xs text-text-muted",children:"Всего целей"})]}),e.jsxs("div",{className:"p-4 bg-accent-purple/10 border border-accent-purple/20 rounded-glass-sm text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-accent-purple",children:n.totalPlans}),e.jsx("div",{className:"text-xs text-text-muted",children:"Планов 90 дней"})]}),e.jsxs("div",{className:"p-4 bg-accent-cyan/10 border border-accent-cyan/20 rounded-glass-sm text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-accent-cyan",children:n.totalDailyPages}),e.jsx("div",{className:"text-xs text-text-muted",children:"Ежедневных страниц"})]}),e.jsxs("div",{className:"p-4 bg-success/10 border border-success/20 rounded-glass-sm text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-success",children:n.completedDays}),e.jsx("div",{className:"text-xs text-text-muted",children:"Завершённых дней"})]}),e.jsxs("div",{className:"p-4 bg-accent-pink/10 border border-accent-pink/20 rounded-glass-sm text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-accent-pink",children:n.totalReviews}),e.jsx("div",{className:"text-xs text-text-muted",children:"Недельных обзоров"})]}),e.jsxs("div",{className:"p-4 bg-accent-orange/10 border border-accent-orange/20 rounded-glass-sm text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-accent-orange",children:[n.storageUsed," KB"]}),e.jsx("div",{className:"text-xs text-text-muted",children:"Использовано"})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{variant:"gradient",accentColor:"emerald",children:[e.jsx("h3",{className:"font-semibold text-text-primary mb-4",children:"Экспорт данных"}),e.jsx("p",{className:"text-sm text-text-secondary mb-4",children:"Создайте резервную копию всех ваших данных в формате JSON. Вы сможете импортировать её позже на этом или другом устройстве."}),e.jsx(N,{onClick:E,variant:"secondary",className:"w-full",children:"Скачать резервную копию (JSON)"})]}),e.jsxs(i,{children:[e.jsx("h3",{className:"font-semibold text-text-primary mb-4",children:"Импорт данных"}),e.jsx("p",{className:"text-sm text-text-secondary mb-4",children:"Восстановите данные из ранее созданной резервной копии. Это заменит все текущие данные."}),y&&e.jsx("div",{className:"p-4 bg-success/20 border border-success/30 rounded-glass-sm mb-4",children:e.jsx("p",{className:"text-sm text-success",children:"Данные успешно импортированы! Страница обновится через несколько секунд..."})}),u&&e.jsx("div",{className:"p-4 bg-danger/20 border border-danger/30 rounded-glass-sm mb-4",children:e.jsx("p",{className:"text-sm text-danger",children:u})}),e.jsx("input",{type:"file",accept:".json",onChange:I,className:`block w-full text-sm text-text-secondary\r
                  file:mr-4 file:py-2 file:px-4\r
                  file:rounded-glass-sm file:border-0\r
                  file:text-sm file:font-medium\r
                  file:bg-accent-blue file:text-white\r
                  hover:file:bg-accent-purple\r
                  file:cursor-pointer cursor-pointer\r
                  file:transition-colors`})]}),e.jsx(i,{className:"border-2 border-danger/30",children:e.jsxs("div",{className:"p-4 bg-danger/10 rounded-glass-sm",children:[e.jsx("h3",{className:"font-semibold text-danger mb-4",children:"Опасная зона"}),e.jsx("p",{className:"text-sm text-text-secondary mb-4",children:"Удаление всех данных без возможности восстановления. Используйте только если уверены, что хотите начать с чистого листа."}),e.jsx(N,{variant:"danger",onClick:R,className:"w-full",children:"Удалить все данные"})]})})]})]})]})})}export{G as default};
